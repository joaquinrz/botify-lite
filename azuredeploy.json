{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
      "location": {
        "type": "string",
        "defaultValue": "[resourceGroup().location]",
        "metadata": {
          "description": "The location for the Azure OpenAI resource. Note: Azure OpenAI is not available in all regions."
        }
      },

      "openAIServiceName": {
        "type": "string",
        "defaultValue": "[format('openai-service-{0}', uniqueString(resourceGroup().id))]"
      },
      "openAIModelName": {
        "type": "string",
        "defaultValue": "gpt-4o",
        "allowedValues": [
          "gpt-4o-mini"
        ]
      },
    "openAIServiceEndpoint": {
        "type": "string",
        "value": "[reference(resourceId('Microsoft.CognitiveServices/accounts', parameters('openAIServiceName'))).endpoint]"
    }
    },
    "variables": {
      "appPlanSkuName": "S1",
      "cognitiveServiceSKU": "S0"
    },
    "resources": [
        {
            "type": "Microsoft.CognitiveServices/accounts",
            "apiVersion": "2023-05-01",
            "name": "[parameters('openAIResourceName')]",
            "location": "[parameters('location')]",
            "sku": {
                "name": "[parameters('sku')]"
            },
            "kind": "OpenAI",
            "properties": {
                "customSubDomainName": "[toLower(parameters('openAIResourceName'))]",
                "publicNetworkAccess": "Enabled"
            }
        },

    {
      "type": "Microsoft.CognitiveServices/accounts/deployments",
      "apiVersion": "2023-05-01",
      "name": "[concat(parameters('openAIServiceName'), '/', parameters('openAIModelName'))]",
      "dependsOn": [
        "[resourceId('Microsoft.CognitiveServices/accounts', parameters('openAIServiceName'))]"
      ],
      "sku": {
                "name": "GlobalStandard",
                "capacity": 100
            },
      "properties": {
        "model": {
          "format": "OpenAI",
          "name": "[parameters('openAIModelName')]",
          "version": "2024-08-06"
        }
      }
    }
    ],
    "outputs": {
      "openAIServiceEndpoint": {
        "type": "string",
        "value": "[reference(resourceId('Microsoft.CognitiveServices/accounts', parameters('openAIServiceName'))).endpoint]"
      },
     "openAIModelName": {
        "type": "string",
        "value": "[parameters('openAIModelName')]"
      }

    }
  }